\section{Introduction}
\label{sec:intro}

This report details a project regarding the property-based fuzzing of smart contracts. Specifically, echidna was used to assert the correctness of the program logic by defining invariants that encapsulate the logical assumptions of the underlying algorithm. Two smart contracts, Taxpayer.sol and Lottery.sol, were examined. Taxpayer.sol provides the logic to manage tax-related variables of individuals as well as their marital status. Lottery.sol models a lottery based on a commit-and-reveal schema.

%-------------------------------------------------------------------------
\subsection{Fuzzing}
Man√®s et al. define Fuzzing as the following:
\begin{quote}
  Fuzzing is the execution of the PUT [Program Under Test] using input(s) sampled from an input space (the ``fuzz input space'') that protrudes the expected input space of the PUT \cite{manes2019art}.
\end{quote}

They explain further that "fuzz testing" can be used to examine if a program violates the logical and safety constraints it is designed to fulfill. This is accomplished by using inputs to the algorithm that may be unaccounted for during the initial design \cite{manes2019art}.

%-------------------------------------------------------------------------
\subsection{Property-based fuzzing using Echidna}
Echidna is a property-based fuzzing tool for EVM (Ethereum Virtual Machine) smart contracts. It challenges invariants set by the developer by employing various fuzzing techniques on the provided Solidity class. At its core, Echidna generates random inputs for class functions, which it then executes in a random order. It keeps track of the program state and the executed lines. After every transaction, the user-defined invariants are checked for validity.

A simple property can be defined as follows (see Listing \ref{lst:no-self-marriage}):

\noindent
\begin{minipage}{\linewidth}
  \lstinputlisting[ language=Solidity, firstline=47, lastline=49, caption={Invariant to prevent self-marriage in Taxpayer.sol}, label={lst:no-self-marriage} ]{../../echidna.sol}
\end{minipage}

It ensures that a Taxpayer represented by his/her Taxpayer contract cannot marry himself/herself. Echidna properties are defined as functions that have no arguments, start with the prefix \texttt{echidna\_} and return a boolean value.

If any invariant defined as a property fails, Echidna raises an error and provides the execution flow that led to it. This way, developers can detect unaccounted edge cases and security flaws in their provided code. Furthermore, it creates a detailed report of the program code that ran during the testing phase. Developers can use this information to assert the effectiveness of the defined testing process.